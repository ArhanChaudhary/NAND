<!DOCTYPE html>
    <html lang="en">
    <head>
        <script type="module">
            import {
                step,
                loadROM,
                getRAM,
                getScreen,
                Keyboard,
            } from "./build/release.js"
            loadROM();

            const offscreen = document.querySelector('canvas').transferControlToOffscreen();
            const screen = new Worker('screen.js');
            screen.postMessage(offscreen, [offscreen]);

            function computer() {
                let now = performance.now();
                while (performance.now() - now < 75) {
                    step();
                }
                screen.postMessage(getScreen());
                setTimeout(computer, 0);
            }
            computer();

            document.addEventListener('keydown', e => {
                let keyValue = {
                    'Enter': 128,
                    'Backspace': 129,
                    'ArrowLeft': 130,
                    'ArrowUp': 131,
                    'ArrowRight': 132,
                    'ArrowDown': 133,
                    'Delete': 139,
                    'Escape': 140,
                    'F1': 141,
                    'F2': 142,
                    'F3': 143,
                    'F4': 144,
                    'F5': 145,
                    'F6': 146,
                    'F7': 147,
                    'F8': 148,
                    'F9': 149,
                    'F10': 150,
                    'F11': 151,
                    'F12': 152,
                }[e.key];
                if (!keyValue)
                    keyValue = e.key.charCodeAt(0);
                Keyboard(true, keyValue);
            });

            document.addEventListener('keyup', e => {
                Keyboard(true, 0);
            });
        </script>
        <style>
            body {
                background-color: tan;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            canvas {
                image-rendering: pixelated;
                image-rendering: crisp-edges;
                border: 2px solid black;
                background: white;
            }
        </style>
    </head>
    <body>
        <canvas width="512" height="256"></canvas>
    </body>
</html>
